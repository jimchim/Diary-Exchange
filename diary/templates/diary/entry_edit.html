{% extends 'base.html' %}

{% block css %}
	<style type="text/css">
		.form-control, .btn {
			border-radius: 0;
			margin-top: 1em;
		}

		textarea {
			min-height: 20em;
			max-width: 100%;
			resize: none;
		}

		img {
			width: 100%;
			margin-top: 1em;
		}

		img.half-size {
			width: 50%;
		}




	</style>
{% endblock css %}

{% block content %}	
	{% if entry %}
		<form id = 'edit-entry-form' action = "{% url 'diary:entry_edit' entry.id %}" method = 'post' enctype="multipart/form-data">
			{% csrf_token %}
			<button id = 'delete-entry' class = 'btn btn-danger'>Delete Entry</button>
			<input type = 'submit' value = 'Update Entry' class = 'btn btn-warning pull-right'>
			<input class = 'form-control' type = 'text' name = 'entry-subject' value = '{{ entry.subject }}' autocomplete = 'off'>
			<textarea class = 'form-control' name = 'entry-body'>{{ entry.body}}</textarea>
			<input type = 'hidden' value = 'False' name = 'entry-delete'>

			<input class = 'form-control' type = 'hidden' placeholder = 'Selected Photo' name = 'selected-entry-photo'>

			<input class = 'form-control' type = 'file' name = 'new-entry-photo' multiple>
			{% if entry.entryphoto_set.first != None %}
				{% for picture in entry.entryphoto_set.all %}
					{# <h1>{{ picture.id }}</h1> #}
					<img src="{{picture.image_file.url}}" id = '{{ picture.id }}' >
				{% endfor%}
			{% endif %}
		</form>



	{% else %}
		<h1>This is edit entry page</h1>
	{% endif %}

	

{% endblock content %}

{% block script %}
	{% load staticfiles %}
	<script type="text/javascript" src = '{% static "library/autosize/jquery.autosize.min.js" %}'></script>	
	<script type="text/javascript">
		$(document).ready(function(){
			$('#delete-entry').click(function(){
				var delEntry = confirm('Delete this diary entry?')
				if (delEntry) {
					$("input[name='entry-delete']").val('True')										
					$('#edit-entry-form').submit()
					return false
					
				}

				else {
					return false
				}


			})

			$('#edit-entry-form textarea').focus(function(){
				$(this).autosize();
			})

			$('img').click(function(){				
				var selectPhotoIDs = $("input[name='selected-entry-photo']").val()				
				var thisID = $(this).attr('id')
				var IDs = selectPhotoIDs.split(',')				
				if (IDs.indexOf(thisID) == -1) {					
					var photoIDToAdd = thisID + ','
					selectPhotoIDs += photoIDToAdd
					$("input[name='selected-entry-photo']").val(selectPhotoIDs)	
					$(this).addClass('half-size')
				} 

				else {
					/*alert(IDs)
					alert(IDs)*/
					IDs.splice(IDs.indexOf(thisID),1)
					$("input[name='selected-entry-photo']").val(IDs)					
					$(this).removeClass('half-size')
				}
				
				
			})
		})		
	</script>

{% endblock script %}